// ЁЯОп Speak EU - European Language Learning Platform
// Optimized Version - No Loading Issues
// For Bangladeshi Expatriates in Europe

'use strict';

console.log('ЁЯЪА Speak EU Starting...');

// ЁЯМН Global Configuration
const CONFIG = {
  APP_NAME: 'Speak EU',
  VERSION: '3.0.0',
  STORAGE_PREFIX: 'speak_eu_',
  DAILY_TARGET: 15,
  ANIMATION_DURATION: 300,
  SPEECH_LANG_MAP: {
    'de': 'de-DE', 'fr': 'fr-FR', 'it': 'it-IT', 'es': 'es-ES', 'ru': 'ru-RU',
    'pl': 'pl-PL', 'nl': 'nl-NL', 'pt': 'pt-PT', 'sv': 'sv-SE', 'da': 'da-DK',
    'no': 'nb-NO', 'fi': 'fi-FI', 'el': 'el-GR', 'cs': 'cs-CZ', 'sk': 'sk-SK',
    'hu': 'hu-HU', 'hr': 'hr-HR', 'sl': 'sl-SI', 'et': 'et-EE', 'lv': 'lv-LV',
    'lt': 'lt-LT', 'is': 'is-IS'
  }
};

// ЁЯЧ║я╕П Complete Language Data (28 European Countries)
const LANGUAGES = {
  // ЁЯФе High Priority Countries
  germany: {
    code: 'de', name: 'ржЬрж╛рж░рзНржорж╛ржи', nativeName: 'Deutsch', country: 'ржЬрж╛рж░рзНржорж╛ржирж┐',
    flag: 'ЁЯЗйЁЯЗк', type: 'schengen', population: '83M', difficulty: 'intermediate',
    wordCount: 5284, categories: 23, priority: 'high', capital: 'ржмрж╛рж░рзНрж▓рж┐ржи'
  },
  france: {
    code: 'fr', name: 'ржлрж░рж╛рж╕рж┐', nativeName: 'Fran├зais', country: 'ржлрзНрж░рж╛ржирзНрж╕',
    flag: 'ЁЯЗлЁЯЗ╖', type: 'schengen', population: '68M', difficulty: 'intermediate',
    wordCount: 5156, categories: 23, priority: 'high', capital: 'ржкрзНржпрж╛рж░рж┐рж╕'
  },
  italy: {
    code: 'it', name: 'ржЗрждрж╛рж▓рж┐ржпрж╝рж╛ржи', nativeName: 'Italiano', country: 'ржЗрждрж╛рж▓рж┐',
    flag: 'ЁЯЗоЁЯЗ╣', type: 'schengen', population: '60M', difficulty: 'beginner',
    wordCount: 4987, categories: 23, priority: 'high', capital: 'рж░рзЛржо'
  },
  spain: {
    code: 'es', name: 'рж╕рзНржкрзНржпрж╛ржирж┐рж╢', nativeName: 'Espa├▒ol', country: 'рж╕рзНржкрзЗржи',
    flag: 'ЁЯЗкЁЯЗ╕', type: 'schengen', population: '47M', difficulty: 'beginner',
    wordCount: 5342, categories: 23, priority: 'high', capital: 'ржорж╛ржжрзНрж░рж┐ржж'
  },
  netherlands: {
    code: 'nl', name: 'ржбрж╛ржЪ', nativeName: 'Nederlands', country: 'ржирзЗржжрж╛рж░рж▓рзНржпрж╛ржирзНржбрж╕',
    flag: 'ЁЯЗ│ЁЯЗ▒', type: 'schengen', population: '17M', difficulty: 'intermediate',
    wordCount: 4723, categories: 22, priority: 'high', capital: 'ржЖржорж╕рзНржЯрж╛рж░рзНржбрж╛ржо'
  },
  poland: {
    code: 'pl', name: 'ржкрзЛрж▓рж┐рж╢', nativeName: 'Polski', country: 'ржкрзЛрж▓рзНржпрж╛ржирзНржб',
    flag: 'ЁЯЗ╡ЁЯЗ▒', type: 'schengen', population: '38M', difficulty: 'advanced',
    wordCount: 4432, categories: 22, priority: 'high', capital: 'ржУржпрж╝рж╛рж░рж╢'
  },
  russia: {
    code: 'ru', name: 'рж░рзБрж╢', nativeName: '╨а╤Г╤Б╤Б╨║╨╕╨╣', country: 'рж░рж╛рж╢рж┐ржпрж╝рж╛',
    flag: 'ЁЯЗ╖ЁЯЗ║', type: 'non-schengen', population: '146M', difficulty: 'advanced',
    wordCount: 5678, categories: 23, priority: 'high', capital: 'ржорж╕рзНржХрзЛ'
  },

  // ЁЯЯб Medium Priority Countries
  belgium: {
    code: 'nl', name: 'ржбрж╛ржЪ/ржлрж░рж╛рж╕рж┐', nativeName: 'Nederlands/Fran├зais', country: 'ржмрзЗрж▓ржЬрж┐ржпрж╝рж╛ржо',
    flag: 'ЁЯЗзЁЯЗк', type: 'schengen', population: '11M', difficulty: 'intermediate',
    wordCount: 4156, categories: 21, priority: 'medium', capital: 'ржмрзНрж░рж╛рж╕рзЗрж▓рж╕'
  },
  austria: {
    code: 'de', name: 'ржЬрж╛рж░рзНржорж╛ржи', nativeName: 'Deutsch (├Цsterreich)', country: 'ржЕрж╕рзНржЯрзНрж░рж┐ржпрж╝рж╛',
    flag: 'ЁЯЗжЁЯЗ╣', type: 'schengen', population: '9M', difficulty: 'intermediate',
    wordCount: 4892, categories: 21, priority: 'medium', capital: 'ржнрж┐ржпрж╝рзЗржирж╛'
  },
  portugal: {
    code: 'pt', name: 'ржкрж░рзНрждрзБржЧрж┐ржЬ', nativeName: 'Portugu├кs', country: 'ржкрж░рзНрждрзБржЧрж╛рж▓',
    flag: 'ЁЯЗ╡ЁЯЗ╣', type: 'schengen', population: '10M', difficulty: 'intermediate',
    wordCount: 4567, categories: 21, priority: 'medium', capital: 'рж▓рж┐рж╕ржмржи'
  },
  greece: {
    code: 'el', name: 'ржЧрзНрж░рж┐ржХ', nativeName: '╬Х╬╗╬╗╬╖╬╜╬╣╬║╬м', country: 'ржЧрзНрж░рж┐рж╕',
    flag: 'ЁЯЗмЁЯЗ╖', type: 'schengen', population: '11M', difficulty: 'advanced',
    wordCount: 3987, categories: 20, priority: 'medium', capital: 'ржПржерзЗржирзНрж╕'
  },
  sweden: {
    code: 'sv', name: 'рж╕рзБржЗржбрж┐рж╢', nativeName: 'Svenska', country: 'рж╕рзБржЗржбрзЗржи',
    flag: 'ЁЯЗ╕ЁЯЗк', type: 'schengen', population: '10M', difficulty: 'intermediate',
    wordCount: 4234, categories: 20, priority: 'medium', capital: 'рж╕рзНржЯржХрж╣рзЛржо'
  },
  norway: {
    code: 'no', name: 'ржирж░ржУржпрж╝рзЗржЬрж┐ржпрж╝рж╛ржи', nativeName: 'Norsk', country: 'ржирж░ржУржпрж╝рзЗ',
    flag: 'ЁЯЗ│ЁЯЗ┤', type: 'schengen', population: '5M', difficulty: 'intermediate',
    wordCount: 4156, categories: 20, priority: 'medium', capital: 'ржЕрж╕рж▓рзЛ'
  },
  denmark: {
    code: 'da', name: 'ржбрзЗржирж┐рж╢', nativeName: 'Dansk', country: 'ржбрзЗржиржорж╛рж░рзНржХ',
    flag: 'ЁЯЗйЁЯЗ░', type: 'schengen', population: '6M', difficulty: 'intermediate',
    wordCount: 3987, categories: 19, priority: 'medium', capital: 'ржХрзЛржкрзЗржирж╣рзЗржЧрзЗржи'
  },
  czechia: {
    code: 'cs', name: 'ржЪрзЗржХ', nativeName: '─Мe┼бtina', country: 'ржЪрзЗржХ ржкрзНрж░ржЬрж╛рждржирзНрждрзНрж░',
    flag: 'ЁЯЗиЁЯЗ┐', type: 'schengen', population: '11M', difficulty: 'advanced',
    wordCount: 3876, categories: 19, priority: 'medium', capital: 'ржкрзНрж░рж╛ржЧ'
  },

  // ЁЯФ╡ Lower Priority Countries
  finland: {
    code: 'fi', name: 'ржлрж┐ржирж┐рж╢', nativeName: 'Suomi', country: 'ржлрж┐ржирж▓рзНржпрж╛ржирзНржб',
    flag: 'ЁЯЗлЁЯЗо', type: 'schengen', population: '6M', difficulty: 'advanced',
    wordCount: 3765, categories: 18, priority: 'low', capital: 'рж╣рзЗрж▓рж╕рж┐ржЩрзНржХрж┐'
  },
  slovakia: {
    code: 'sk', name: 'рж╕рзНрж▓рзЛржнрж╛ржХ', nativeName: 'Sloven─Нina', country: 'рж╕рзНрж▓рзЛржнрж╛ржХрж┐ржпрж╝рж╛',
    flag: 'ЁЯЗ╕ЁЯЗ░', type: 'schengen', population: '5M', difficulty: 'advanced',
    wordCount: 3654, categories: 18, priority: 'low', capital: 'ржмрзНрж░рж╛рждрж┐рж╕рзНрж▓рж╛ржнрж╛'
  },
  hungary: {
    code: 'hu', name: 'рж╣рж╛ржЩрзНржЧрзЗрж░рж┐ржпрж╝рж╛ржи', nativeName: 'Magyar', country: 'рж╣рж╛ржЩрзНржЧрзЗрж░рж┐',
    flag: 'ЁЯЗнЁЯЗ║', type: 'schengen', population: '10M', difficulty: 'advanced',
    wordCount: 3543, categories: 17, priority: 'low', capital: 'ржмрзБржжрж╛ржкрзЗрж╕рзНржЯ'
  },
  slovenia: {
    code: 'sl', name: 'рж╕рзНрж▓рзЛржнрзЗржирж┐ржпрж╝рж╛ржи', nativeName: 'Sloven┼б─Нina', country: 'рж╕рзНрж▓рзЛржнрзЗржирж┐ржпрж╝рж╛',
    flag: 'ЁЯЗ╕ЁЯЗо', type: 'schengen', population: '2M', difficulty: 'advanced',
    wordCount: 3234, categories: 16, priority: 'low', capital: 'рж▓рзБржмрж▓рж┐ржпрж╝рж╛ржирж╛'
  },
  croatia: {
    code: 'hr', name: 'ржХрзНрж░рзЛржпрж╝рзЗрж╢рж┐ржпрж╝рж╛ржи', nativeName: 'Hrvatski', country: 'ржХрзНрж░рзЛржпрж╝рзЗрж╢рж┐ржпрж╝рж╛',
    flag: 'ЁЯЗнЁЯЗ╖', type: 'schengen', population: '4M', difficulty: 'advanced',
    wordCount: 3456, categories: 17, priority: 'low', capital: 'ржЬрж╛ржЧрзНрж░рзЗржм'
  },
  estonia: {
    code: 'et', name: 'ржПрж╕рзНрждрзЛржирж┐ржпрж╝рж╛ржи', nativeName: 'Eesti', country: 'ржПрж╕рзНрждрзЛржирж┐ржпрж╝рж╛',
    flag: 'ЁЯЗкЁЯЗк', type: 'schengen', population: '1M', difficulty: 'advanced',
    wordCount: 2987, categories: 15, priority: 'low', capital: 'рждрж╛рж▓рж┐ржи'
  },
  latvia: {
    code: 'lv', name: 'рж▓рж╛ржЯржнрж┐ржпрж╝рж╛ржи', nativeName: 'Latvie┼бu', country: 'рж▓рж╛ржЯржнрж┐ржпрж╝рж╛',
    flag: 'ЁЯЗ▒ЁЯЗ╗', type: 'schengen', population: '2M', difficulty: 'advanced',
    wordCount: 3123, categories: 16, priority: 'low', capital: 'рж░рж┐ржЧрж╛'
  },
  lithuania: {
    code: 'lt', name: 'рж▓рж┐ржерзБржпрж╝рж╛ржирж┐ржпрж╝рж╛ржи', nativeName: 'Lietuvi┼│', country: 'рж▓рж┐ржерзБржпрж╝рж╛ржирж┐ржпрж╝рж╛',
    flag: 'ЁЯЗ▒ЁЯЗ╣', type: 'schengen', population: '3M', difficulty: 'advanced',
    wordCount: 3234, categories: 16, priority: 'low', capital: 'ржнрж┐рж▓ржирж┐ржЙрж╕'
  },
  luxembourg: {
    code: 'fr', name: 'ржлрж░рж╛рж╕рж┐/ржЬрж╛рж░рзНржорж╛ржи', nativeName: 'Fran├зais/Deutsch', country: 'рж▓рзБржХрзНрж╕рзЗржоржмрж╛рж░рзНржЧ',
    flag: 'ЁЯЗ▒ЁЯЗ║', type: 'schengen', population: '0.6M', difficulty: 'intermediate',
    wordCount: 2876, categories: 14, priority: 'low', capital: 'рж▓рзБржХрзНрж╕рзЗржоржмрж╛рж░рзНржЧ'
  },
  malta: {
    code: 'en', name: 'ржорж╛рж▓рзНржЯрж┐ржЬ/ржЗржВрж░рзЗржЬрж┐', nativeName: 'Malti/English', country: 'ржорж╛рж▓рзНржЯрж╛',
    flag: 'ЁЯЗ▓ЁЯЗ╣', type: 'schengen', population: '0.5M', difficulty: 'beginner',
    wordCount: 2456, categories: 13, priority: 'low', capital: 'ржнрзНржпрж╛рж▓рзЗрждрзНрждрж╛'
  },
  cyprus: {
    code: 'el', name: 'ржЧрзНрж░рж┐ржХ', nativeName: '╬Х╬╗╬╗╬╖╬╜╬╣╬║╬м (╬Ъ╧Н╧А╧Б╬┐╧В)', country: 'рж╕рж╛ржЗржкрзНрж░рж╛рж╕',
    flag: 'ЁЯЗиЁЯЗ╛', type: 'schengen', population: '1M', difficulty: 'advanced',
    wordCount: 2789, categories: 14, priority: 'low', capital: 'ржирж┐ржХрзЛрж╕рж┐ржпрж╝рж╛'
  },
  iceland: {
    code: 'is', name: 'ржЖржЗрж╕рж▓рзНржпрж╛ржирзНржбрж┐ржХ', nativeName: '├Нslenska', country: 'ржЖржЗрж╕рж▓рзНржпрж╛ржирзНржб',
    flag: 'ЁЯЗоЁЯЗ╕', type: 'schengen', population: '0.4M', difficulty: 'advanced',
    wordCount: 2234, categories: 12, priority: 'low', capital: 'рж░рзЗржЗржХрж┐ржпрж╝рж╛ржнрж┐ржХ'
  },
  liechtenstein: {
    code: 'de', name: 'ржЬрж╛рж░рзНржорж╛ржи', nativeName: 'Deutsch (Liechtenstein)', country: 'рж▓рж┐ржЪрзЗржирж╕рзНржЯрж╛ржЗржи',
    flag: 'ЁЯЗ▒ЁЯЗо', type: 'schengen', population: '0.04M', difficulty: 'intermediate',
    wordCount: 1987, categories: 11, priority: 'low', capital: 'ржнрж╛ржжрзБрзОрж╕'
  }
};

// ЁЯУК Learning Categories (23 Essential Categories)
const CATEGORIES = {
  emergency: { name: 'ржЬрж░рзБрж░рж┐ ржЕржмрж╕рзНржерж╛', icon: 'ЁЯЪи', priority: 1, color: '#ff4757' },
  daily: { name: 'ржжрзИржиржирзНржжрж┐ржи ржХржерзЛржкржХржержи', icon: 'ЁЯТм', priority: 2, color: '#3742fa' },
  greetings: { name: 'рж╢рзБржнрзЗржЪрзНржЫрж╛ ржУ ржкрж░рж┐ржЪржпрж╝', icon: 'ЁЯСЛ', priority: 3, color: '#2ed573' },
  work: { name: 'ржХрж╛ржЬ ржУ ржкрзЗрж╢рж╛', icon: 'ЁЯТ╝', priority: 4, color: '#ff6348' },
  travel: { name: 'ржнрзНрж░ржоржг ржУ ржкрж░рж┐ржмрж╣ржи', icon: 'тЬИя╕П', priority: 5, color: '#ff7675' },
  accommodation: { name: 'ржерж╛ржХрж╛рж░ ржмрзНржпржмрж╕рзНржерж╛', icon: 'ЁЯПи', priority: 6, color: '#a29bfe' },
  education: { name: 'рж╢рж┐ржХрзНрж╖рж╛ ржУ ржмрж┐рж╢рзНржмржмрж┐ржжрзНржпрж╛рж▓ржпрж╝', icon: 'ЁЯОУ', priority: 7, color: '#6c5ce7' },
  health: { name: 'рж╕рзНржмрж╛рж╕рзНржерзНржп ржУ ржЪрж┐ржХрж┐рзОрж╕рж╛', icon: 'ЁЯПе', priority: 8, color: '#fd79a8' },
  shopping: { name: 'ржХрзЗржирж╛ржХрж╛ржЯрж╛ ржУ ржмрж╛ржЬрж╛рж░', icon: 'ЁЯЫНя╕П', priority: 9, color: '#fdcb6e' },
  banking: { name: 'ржмрзНржпрж╛ржВржХрж┐ржВ ржУ ржЖрж░рзНржерж┐ржХ', icon: 'ЁЯПж', priority: 10, color: '#00b894' },
  government: { name: 'рж╕рж░ржХрж╛рж░рж┐ ржХрж╛ржЬ', icon: 'ЁЯПЫя╕П', priority: 11, color: '#00cec9' },
  legal: { name: 'ржЖржЗржирж┐ ржмрж┐рж╖ржпрж╝', icon: 'тЪЦя╕П', priority: 12, color: '#74b9ff' },
  numbers: { name: 'рж╕ржВржЦрзНржпрж╛ ржУ рж╕ржоржпрж╝', icon: 'ЁЯФв', priority: 13, color: '#0984e3' },
  food: { name: 'ржЦрж╛ржмрж╛рж░ ржУ ржкрж╛ржирзАржпрж╝', icon: 'ЁЯН╜я╕П', priority: 14, color: '#e84393' },
  technology: { name: 'ржкрзНрж░ржпрзБржХрзНрждрж┐ ржУ ржЗржирзНржЯрж╛рж░ржирзЗржЯ', icon: 'ЁЯТ╗', priority: 15, color: '#9b59b6' },
  weather: { name: 'ржЖржмрж╣рж╛ржУржпрж╝рж╛ ржУ ржкрзНрж░ржХрзГрждрж┐', icon: 'ЁЯМдя╕П', priority: 16, color: '#f39c12' },
  family: { name: 'ржкрж░рж┐ржмрж╛рж░ ржУ рж╕ржорзНржкрж░рзНржХ', icon: 'ЁЯСитАНЁЯСйтАНЁЯСзтАНЁЯСж', priority: 17, color: '#e67e22' },
  hobbies: { name: 'рж╢ржЦ ржУ ржмрж┐ржирзЛржжржи', icon: 'ЁЯОо', priority: 18, color: '#27ae60' },
  sports: { name: 'ржЦрзЗрж▓рж╛ржзрзБрж▓рж╛ ржУ ржмрзНржпрж╛ржпрж╝рж╛ржо', icon: 'тЪ╜', priority: 19, color: '#16a085' },
  culture: { name: 'рж╕ржВрж╕рзНржХрзГрждрж┐ ржУ ржРрждрж┐рж╣рзНржп', icon: 'ЁЯОн', priority: 20, color: '#8e44ad' },
  directions: { name: 'ржжрж┐ржХржирж┐рж░рзНржжрзЗрж╢ржирж╛', icon: 'ЁЯзн', priority: 21, color: '#2c3e50' },
  clothing: { name: 'ржкрзЛрж╢рж╛ржХ ржУ ржлрзНржпрж╛рж╢ржи', icon: 'ЁЯСХ', priority: 22, color: '#34495e' },
  body: { name: 'рж╢рж░рзАрж░ ржУ ржЕржЩрзНржЧржкрзНрж░рждрзНржпржЩрзНржЧ', icon: 'ЁЯзСтАНтЪХя╕П', priority: 23, color: '#95a5a6' }
};

// ЁЯОп Simple Application State
class SimpleAppState {
  constructor() {
    this.currentLanguage = null;
    this.currentSection = 'home';
    this.vocabularyData = new Map();
    this.userProgress = new Map();
    this.favorites = new Set();
    this.settings = {
      theme: 'light',
      autoPlay: true,
      speechRate: 1,
      fontSize: 'medium'
    };
    this.isReady = false;
  }

  save() {
    try {
      const data = {
        currentLanguage: this.currentLanguage,
        userProgress: Array.from(this.userProgress.entries()),
        favorites: Array.from(this.favorites),
        settings: this.settings
      };
      localStorage.setItem(CONFIG.STORAGE_PREFIX + 'state', JSON.stringify(data));
    } catch (error) {
      console.warn('Save failed:', error);
    }
  }

  load() {
    try {
      const saved = localStorage.getItem(CONFIG.STORAGE_PREFIX + 'state');
      if (saved) {
        const data = JSON.parse(saved);
        this.currentLanguage = data.currentLanguage;
        this.userProgress = new Map(data.userProgress || []);
        this.favorites = new Set(data.favorites || []);
        this.settings = { ...this.settings, ...data.settings };
      }
    } catch (error) {
      console.warn('Load failed:', error);
    }
  }

  updateProgress(languageKey, increment = 1) {
    const today = new Date().toDateString();
    const key = `${languageKey}_${today}`;
    const current = this.userProgress.get(key) || { learned: 0, target: CONFIG.DAILY_TARGET };
    current.learned += increment;
    this.userProgress.set(key, current);
    this.save();
    return current;
  }

  getTodayProgress(languageKey) {
    const today = new Date().toDateString();
    const key = `${languageKey}_${today}`;
    return this.userProgress.get(key) || { learned: 0, target: CONFIG.DAILY_TARGET };
  }

  getTotalLearned(languageKey) {
    let total = 0;
    for (const [key, progress] of this.userProgress) {
      if (key.startsWith(languageKey + '_')) {
        total += progress.learned;
      }
    }
    return total;
  }
}

// ЁЯЪА Main Application Class (Simplified & Fast)
class SpeakEU {
  constructor() {
    console.log('ЁЯПЧя╕П Creating Speak EU instance...');
    this.state = new SimpleAppState();
    this.speechSynth = window.speechSynthesis;
    this.currentAudio = null;
    this.searchTimeout = null;
  }

  // ЁЯЪА Quick Initialize (No Loading Screen)
  async init() {
    try {
      console.log('ЁЯЪА Quick initialization starting...');
      
      // Load saved state immediately
      this.state.load();
      
      // Setup core functionality right away
      this.setupEventListeners();
      this.initializeNavigation();
      this.initializeSearch();
      this.initializeMobileMenu();
      this.initializeThemeToggle();
      
      // Load initial content
      this.loadHomeContent();
      
      // Apply saved settings
      this.applySettings();
      
      // Mark as ready
      this.state.isReady = true;
      
      console.log('тЬЕ Speak EU ready!');
      
      // Show welcome message
      setTimeout(() => {
        this.showToast('рж╕рзНржмрж╛ржЧрждржо! Speak EU рждрзЗ ржЖржкржирж╛ржХрзЗ рж╕рзНржмрж╛ржЧржд ржЬрж╛ржирж╛ржЗ ЁЯОЙ', 'success');
      }, 1000);
      
    } catch (error) {
      console.error('тЭМ Quick init failed:', error);
      this.showError('ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи рж▓рзЛржб ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛ред ржкрзЗржЬ рж░рж┐ржлрзНрж░рзЗрж╢ ржХрж░рзБржиред');
    }
  }

  // ЁЯОо Event Listeners Setup
  setupEventListeners() {
    // Window events
    window.addEventListener('resize', this.handleResize.bind(this));
    window.addEventListener('scroll', this.handleScroll.bind(this));
    window.addEventListener('keydown', this.handleKeyboard.bind(this));
    
    // Network status
    window.addEventListener('online', () => this.showToast('ржЕржирж▓рж╛ржЗржи рж╕ржВржпрзЛржЧ ржкрзБржирж░рж╛ржпрж╝ рж╕рзНржерж╛ржкрж┐ржд', 'success'));
    window.addEventListener('offline', () => this.showToast('ржЕржлрж▓рж╛ржЗржи ржорзЛржбрзЗ ржХрж╛ржЬ ржХрж░ржЫрзЗ', 'warning'));
  }

  handleResize() {
    // Handle responsive changes
    this.updateMobileMenu();
  }

  handleScroll() {
    // Handle scroll animations
    this.updateScrollEffects();
  }

  handleKeyboard(e) {
    // Handle keyboard shortcuts
    if (e.ctrlKey || e.metaKey) {
      switch (e.key) {
        case 'k':
          e.preventDefault();
          this.focusSearch();
          break;
        case 'h':
          e.preventDefault();
          this.navigateToSection('home');
          break;
      }
    }
  }

  // ЁЯзн Navigation System
  initializeNavigation() {
    // Desktop navigation
    document.querySelectorAll('.nav-item').forEach(item => {
      item.addEventListener('click', (e) => {
        e.preventDefault();
        const section = item.getAttribute('data-section');
        this.navigateToSection(section);
      });
    });
    
    // Mobile navigation
    document.querySelectorAll('.mobile-nav-item').forEach(item => {
      item.addEventListener('click', (e) => {
        e.preventDefault();
        const section = item.getAttribute('data-section');
        this.navigateToSection(section);
        this.closeMobileMenu();
      });
    });
    
    // Quick action buttons
    document.querySelectorAll('[data-action]').forEach(button => {
      button.addEventListener('click', (e) => {
        e.preventDefault();
        const action = button.getAttribute('data-action');
        this.handleQuickAction(action);
      });
    });
    
    // Browser back/forward
    window.addEventListener('popstate', (e) => {
      const section = e.state?.section || 'home';
      this.navigateToSection(section, false);
    });
  }

  navigateToSection(sectionName, pushState = true) {
    console.log(`ЁЯУН Navigate to: ${sectionName}`);
    
    this.state.currentSection = sectionName;
    this.state.save();
    
    if (pushState) {
      history.pushState({ section: sectionName }, '', `#${sectionName}`);
    }
    
    // Update navigation
    document.querySelectorAll('.nav-item, .mobile-nav-item').forEach(item => {
      item.classList.toggle('active', item.getAttribute('data-section') === sectionName);
    });
    
    // Show section
    document.querySelectorAll('.content-section').forEach(section => {
      section.classList.remove('active');
    });
    
    const targetSection = document.getElementById(sectionName + 'Section');
    if (targetSection) {
      targetSection.classList.add('active');
      this.loadSectionContent(sectionName);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  }

  loadSectionContent(sectionName) {
    switch (sectionName) {
      case 'home': this.loadHomeContent(); break;
      case 'languages': this.loadLanguagesContent(); break;
      case 'learn': this.loadLearningContent(); break;
      case 'progress': this.loadProgressContent(); break;
      case 'favorites': this.loadFavoritesContent(); break;
      case 'settings': this.loadSettingsContent(); break;
    }
  }

  handleQuickAction(action) {
    console.log(`тЪб Quick action: ${action}`);
    
    switch (action) {
      case 'start-learning': this.navigateToSection('learn'); break;
      case 'browse-languages': this.navigateToSection('languages'); break;
      case 'emergency': this.showQuickPhrases('emergency'); break;
      case 'daily': this.showQuickPhrases('daily'); break;
      case 'work': this.showQuickPhrases('work'); break;
      case 'travel': this.showQuickPhrases('travel'); break;
      case 'view-progress': this.navigateToSection('progress'); break;
      case 'open-favorites': this.navigateToSection('favorites'); break;
    }
  }

  // ЁЯПа Home Content
  loadHomeContent() {
    console.log('ЁЯПа Loading home...');
    this.loadPopularLanguages();
    this.updateHomeStats();
    this.loadQuickActions();
  }

  loadPopularLanguages() {
    const container = document.getElementById('popularLanguagesGrid');
    if (!container) return;
    
    const popular = Object.entries(LANGUAGES)
      .filter(([_, lang]) => lang.priority === 'high')
      .slice(0, 6);
    
    container.innerHTML = popular.map(([key, lang]) => 
      this.createLanguageCard(key, lang, true)
    ).join('');
    
    // Add click handlers
    container.querySelectorAll('.language-card').forEach(card => {
      card.addEventListener('click', () => {
        const languageKey = card.getAttribute('data-language');
        this.selectLanguage(languageKey);
      });
    });
  }

  updateHomeStats() {
    const totalWords = Object.values(LANGUAGES).reduce((sum, lang) => sum + lang.wordCount, 0);
    const totalCountries = Object.keys(LANGUAGES).length;
    const totalCategories = Object.keys(CATEGORIES).length;
    
    // Update displays safely
    this.updateElement('.stat-countries .stat-number', totalCountries);
    this.updateElement('.stat-words .stat-number', (totalWords / 1000).toFixed(0) + 'K+');
    this.updateElement('.stat-categories .stat-number', totalCategories);
  }

  loadQuickActions() {
    const container = document.getElementById('quickActionsGrid');
    if (!container) return;
    
    const actions = [
      { action: 'emergency', icon: 'ЁЯЪи', title: 'ржЬрж░рзБрж░рж┐ ржЕржмрж╕рзНржерж╛', desc: 'ржЬрж░рзБрж░рж┐ ржкрж░рж┐рж╕рзНржерж┐рждрж┐рж░ ржЬржирзНржп' },
      { action: 'daily', icon: 'ЁЯТм', title: 'ржжрзИржиржирзНржжрж┐ржи ржХржерж╛', desc: 'ржкрзНрж░рждрж┐ржжрж┐ржирзЗрж░ ржХржерзЛржкржХржержи' },
      { action: 'work', icon: 'ЁЯТ╝', title: 'ржХрж╛ржЬрзЗрж░ ржнрж╛рж╖рж╛', desc: 'ржЕржлрж┐рж╕ ржУ ржХрж░рзНржоржХрзНрж╖рзЗрждрзНрж░рзЗ' },
      { action: 'travel', icon: 'тЬИя╕П', title: 'ржнрзНрж░ржоржг', desc: 'ржпрж╛рждрж╛ржпрж╝рж╛ржд ржУ ржнрзНрж░ржоржгрзЗ' }
    ];
    
    container.innerHTML = actions.map(action => `
      <div class="quick-action-card" data-action="${action.action}">
        <div class="action-icon">${action.icon}</div>
        <div class="action-content">
          <h3>${action.title}</h3>
          <p>${action.desc}</p>
        </div>
      </div>
    `).join('');
    
    container.querySelectorAll('.quick-action-card').forEach(card => {
      card.addEventListener('click', () => {
        const action = card.getAttribute('data-action');
        this.handleQuickAction(action);
      });
    });
  }

  // ЁЯМН Languages Content
  loadLanguagesContent() {
    console.log('ЁЯМН Loading languages...');
    this.renderLanguagesGrid();
    this.setupLanguageFilters();
    this.setupLanguageSearch();
  }

  setupLanguageFilters() {
    document.querySelectorAll('.filter-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        const filter = tab.getAttribute('data-filter');
        this.filterLanguages(filter);
      });
    });
  }

  setupLanguageSearch() {
    const searchInput = document.getElementById('languageSearch');
    if (!searchInput) return;
    
    searchInput.addEventListener('input', (e) => {
      clearTimeout(this.searchTimeout);
      this.searchTimeout = setTimeout(() => {
        this.searchLanguages(e.target.value);
      }, 300);
    });
  }

  filterLanguages(filter) {
    const languages = Object.entries(LANGUAGES);
    let filtered = languages;
    
    if (filter === 'popular') {
      filtered = languages.filter(([_, lang]) => lang.priority === 'high');
    } else if (filter !== 'all') {
      filtered = languages.filter(([_, lang]) => lang.type === filter);
    }
    
    this.renderLanguagesGrid(filtered);
  }

  searchLanguages(query) {
    if (!query.trim()) {
      this.renderLanguagesGrid();
      return;
    }
    
    const filtered = Object.entries(LANGUAGES).filter(([_, lang]) => 
      lang.name.toLowerCase().includes(query.toLowerCase()) ||
      lang.country.toLowerCase().includes(query.toLowerCase()) ||
      lang.nativeName.toLowerCase().includes(query.toLowerCase())
    );
    
    this.renderLanguagesGrid(filtered);
  }

  renderLanguagesGrid(languageList = null) {
    const container = document.getElementById('languagesGrid');
    if (!container) return;
    
    const languages = languageList || Object.entries(LANGUAGES);
    
    // Sort by priority
    languages.sort((a, b) => {
      const order = { high: 1, medium: 2, low: 3 };
      return order[a[1].priority] - order[b[1].priority];
    });
    
    if (languages.length === 0) {
      container.innerHTML = `
        <div class="no-results">
          <div class="no-results-icon">ЁЯФН</div>
          <h3>ржХрзЛржи ржлрж▓рж╛ржлрж▓ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝ржирж┐</h3>
          <p>ржЖржкржирж╛рж░ рж╕рж╛рж░рзНржЪ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзЗ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржи</p>
        </div>
      `;
      return;
    }
    
    container.innerHTML = languages.map(([key, lang]) => 
      this.createLanguageCard(key, lang, false)
    ).join('');
    
    // Add click handlers
    container.querySelectorAll('.language-card').forEach(card => {
      card.addEventListener('click', () => {
        const languageKey = card.getAttribute('data-language');
        this.selectLanguage(languageKey);
      });
    });
  }

  createLanguageCard(languageKey, language, isCompact = false) {
    const totalLearned = this.state.getTotalLearned(languageKey);
    const progressPercentage = Math.round((totalLearned / language.wordCount) * 100);
    
    const difficultyColors = { beginner: '#2ed573', intermediate: '#ffa502', advanced: '#ff4757' };
    const difficultyTexts = { beginner: 'рж╕рж╣ржЬ', intermediate: 'ржоржзрзНржпржо', advanced: 'ржХржарж┐ржи' };
    
    return `
      <div class="language-card ${isCompact ? 'compact' : ''}" data-language="${languageKey}">
        <div class="language-header">
          <div class="language-flag">${language.flag}</div>
          <div class="language-info">
            <h3 class="language-name">${language.name}</h3>
            <p class="language-native">${language.nativeName}</p>
            <p class="language-country">${language.country}</p>
            ${!isCompact ? `<p class="language-capital">рж░рж╛ржЬржзрж╛ржирзА: ${language.capital}</p>` : ''}
          </div>
          ${language.priority === 'high' ? '<div class="priority-badge">ржЬржиржкрзНрж░рж┐ржпрж╝</div>' : ''}
        </div>
        
        ${!isCompact ? `
        <div class="language-stats">
          <div class="stat-row">
            <span class="stat-icon">ЁЯСе</span>
            <span>ржЬржирж╕ржВржЦрзНржпрж╛: ${language.population}</span>
          </div>
          <div class="stat-row">
            <span class="stat-icon">ЁЯУЪ</span>
            <span>рж╢ржмрзНржж: ${language.wordCount.toLocaleString()}</span>
          </div>
          <div class="stat-row">
            <span class="stat-icon">ЁЯУК</span>
            <span style="color: ${difficultyColors[language.difficulty]}">
              ${difficultyTexts[language.difficulty]}
            </span>
          </div>
        </div>
        ` : ''}
        
        ${totalLearned > 0 ? `
        <div class="progress-section">
          <div class="progress-info">
            <span>ржЕржЧрзНрж░ржЧрждрж┐: ${progressPercentage}%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: ${progressPercentage}%"></div>
          </div>
          <div class="progress-text">
            <span>рж╢рж┐ржЦрзЗржЫрж┐: ${totalLearned}/${language.wordCount}</span>
          </div>
        </div>
        ` : ''}
        
        <div class="language-actions">
          <button class="btn btn-primary btn-small" onclick="app.selectLanguage('${languageKey}')">
            <span class="btn-icon">ЁЯЪА</span>
            <span>рж╢рж┐ржЦрзБржи</span>
          </button>
          ${!isCompact ? `
          <button class="btn btn-outline btn-small" onclick="app.showLanguageDetails('${languageKey}')">
            <span class="btn-icon">тД╣я╕П</span>
            <span>ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд</span>
          </button>
          ` : ''}
        </div>
      </div>
    `;
  }

  // ЁЯУЪ Learning System
  loadLearningContent() {
    console.log('ЁЯУЪ Loading learning...');
    this.setupLanguageSelection();
    
    if (this.state.currentLanguage) {
      this.loadLanguageContent(this.state.currentLanguage);
    }
  }

  setupLanguageSelection() {
    const select = document.getElementById('languageSelect');
    if (!select) return;
    
    select.innerHTML = '<option value="">ржнрж╛рж╖рж╛ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи...</option>' +
      Object.entries(LANGUAGES)
        .sort((a, b) => {
          const order = { high: 1, medium: 2, low: 3 };
          return order[a[1].priority] - order[b[1].priority];
        })
        .map(([key, lang]) => 
          `<option value="${key}">${lang.flag} ${lang.name} (${lang.country})</option>`
        ).join('');
    
    if (this.state.currentLanguage) {
      select.value = this.state.currentLanguage;
    }
    
    select.addEventListener('change', (e) => {
      if (e.target.value) {
        this.selectLanguage(e.target.value);
      }
    });
  }

  async selectLanguage(languageKey) {
    try {
      console.log(`ЁЯОп Selecting: ${languageKey}`);
      
      this.state.currentLanguage = languageKey;
      this.state.save();
      
      const select = document.getElementById('languageSelect');
      if (select) select.value = languageKey;
      
      await this.loadLanguageContent(languageKey);
      
      if (this.state.currentSection !== 'learn') {
        this.navigateToSection('learn');
      }
      
      const language = LANGUAGES[languageKey];
      this.showToast(`${language.name} ржнрж╛рж╖рж╛ ржирж┐рж░рзНржмрж╛ржЪрж┐ржд рж╣ржпрж╝рзЗржЫрзЗ`, 'success');
      
    } catch (error) {
      console.error('Select language failed:', error);
      this.showToast('ржнрж╛рж╖рж╛ ржирж┐рж░рзНржмрж╛ржЪржирзЗ рж╕ржорж╕рзНржпрж╛', 'error');
    }
  }

  async loadLanguageContent(languageKey) {
    const language = LANGUAGES[languageKey];
    if (!language) return;
    
    try {
      console.log(`ЁЯУЦ Loading: ${language.name}`);
      
      // Generate vocabulary if not exists
      if (!this.state.vocabularyData.has(languageKey)) {
        const vocab = this.generateVocabularyData(languageKey);
        this.state.vocabularyData.set(languageKey, vocab);
      }
      
      const vocab = this.state.vocabularyData.get(languageKey);
      this.updateLearningInterface(languageKey, language, vocab);
      this.showLearningInterface();
      
    } catch (error) {
      console.error('Load language content failed:', error);
      this.showToast('ржнрж╛рж╖рж╛рж░ ржбрзЗржЯрж╛ рж▓рзЛржб ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛', 'error');
    }
  }

  generateVocabularyData(languageKey) {
    const language = LANGUAGES[languageKey];
    const vocab = [];
    
    // Generate for each category
    Object.keys(CATEGORIES).forEach(categoryKey => {
      const category = CATEGORIES[categoryKey];
      const count = Math.min(20, Math.floor(language.wordCount / Object.keys(CATEGORIES).length));
      
      for (let i = 0; i < count; i++) {
        vocab.push({
          id: `${languageKey}_${categoryKey}_${i}`,
          category: categoryKey,
          difficulty: this.getRandomDifficulty(),
          [language.code]: this.getMockPhrase(language.code, categoryKey, i),
          bn: this.getMockBengali(categoryKey, i),
          en: this.getMockEnglish(categoryKey, i),
          pronunciation: `[${language.code} pronunciation]`,
          priority: category.priority
        });
      }
    });
    
    // Sort by priority
    vocab.sort((a, b) => a.priority - b.priority);
    
    console.log(`тЬЕ Generated ${vocab.length} items for ${language.name}`);
    return vocab;
  }

  getRandomDifficulty() {
    const difficulties = ['beginner', 'intermediate', 'advanced'];
    return difficulties[Math.floor(Math.random() * difficulties.length)];
  }

  getMockPhrase(langCode, category, index) {
    const phrases = {
      de: {
        emergency: ['Hilfe!', 'Polizei rufen!', 'Arzt brauchen', 'Feuer!', 'Notfall!'],
        daily: ['Guten Tag', 'Wie geht es?', 'Danke', 'Bitte', 'Entschuldigung'],
        work: ['Ich arbeite', 'Mein Beruf', 'B├╝ro', 'Termin', 'Hilfe brauchen']
      },
      fr: {
        emergency: ['Au secours!', 'Police!', 'M├йdecin', 'Feu!', 'Urgence!'],
        daily: ['Bonjour', 'Comment allez-vous?', 'Merci', 'De rien', 'Excusez-moi'],
        work: ['Je travaille', 'Mon m├йtier', 'Bureau', 'Rendez-vous', 'Aide']
      }
    };
    
    const langPhrases = phrases[langCode] || phrases.de;
    const catPhrases = langPhrases[category] || langPhrases.daily;
    return catPhrases[index % catPhrases.length] || `Phrase ${index + 1}`;
  }

  getMockBengali(category, index) {
    const bengali = {
      emergency: ['рж╕рж╛рж╣рж╛ржпрзНржп!', 'ржкрзБрж▓рж┐рж╢ ржбрж╛ржХрзБржи!', 'ржбрж╛ржХрзНрждрж╛рж░ ржжрж░ржХрж╛рж░', 'ржЖржЧрзБржи!', 'ржЬрж░рзБрж░рж┐!'],
      daily: ['рж╢рзБржн ржжрж┐ржи', 'ржХрзЗржоржи ржЖржЫрзЗржи?', 'ржзржирзНржпржмрж╛ржж', 'рж╕рзНржмрж╛ржЧрждржо', 'ржжрзБржГржЦрж┐ржд'],
      work: ['ржЖржорж┐ ржХрж╛ржЬ ржХрж░рж┐', 'ржЖржорж╛рж░ ржкрзЗрж╢рж╛', 'ржЕржлрж┐рж╕', 'ржЕрзНржпрж╛ржкржпрж╝рзЗржирзНржЯржорзЗржирзНржЯ', 'рж╕рж╛рж╣рж╛ржпрзНржп']
    };
    
    const phrases = bengali[category] || bengali.daily;
    return phrases[index % phrases.length] || `ржмрж╛ржВрж▓рж╛ ${index + 1}`;
  }

  getMockEnglish(category, index) {
    const english = {
      emergency: ['Help!', 'Call police!', 'Need doctor', 'Fire!', 'Emergency!'],
      daily: ['Good day', 'How are you?', 'Thank you', 'Welcome', 'Sorry'],
      work: ['I work', 'My profession', 'Office', 'Appointment', 'Help']
    };
    
    const phrases = english[category] || english.daily;
    return phrases[index % phrases.length] || `English ${index + 1}`;
  }

  updateLearningInterface(languageKey, language, vocab) {
    // Update language header
    this.updateElement('#currentLanguageFlag', language.flag);
    this.updateElement('#currentLanguageName', `${language.name} (${language.nativeName})`);
    this.updateElement('#currentLanguageInfo', `${language.country} тАв ${language.population} ржЬржирж╕ржВржЦрзНржпрж╛`);
    
    // Setup category filter
    this.setupCategoryFilter();
    
    // Display vocabulary
    this.displayVocabulary(vocab.slice(0, 20));
    
    // Update progress
    this.updateLearningStats(languageKey);
    
    // Setup controls
    this.setupLearningControls();
  }

  setupCategoryFilter() {
    const filter = document.getElementById('categoryFilter');
    if (!filter) return;
    
    filter.innerHTML = '<option value="all">рж╕ржм ржХрзНржпрж╛ржЯрж╛ржЧрж░рж┐</option>' +
      Object.entries(CATEGORIES)
        .sort((a, b) => a[1].priority - b[1].priority)
        .map(([key, cat]) => `<option value="${key}">${cat.icon} ${cat.name}</option>`)
        .join('');
    
    filter.addEventListener('change', () => this.filterVocabulary());
  }

  setupLearningControls() {
    // Category filter
    const categoryFilter = document.getElementById('categoryFilter');
    if (categoryFilter) {
      categoryFilter.addEventListener('change', () => this.filterVocabulary());
    }
    
    // Shuffle button
    const shuffleBtn = document.getElementById('shuffleBtn');
    if (shuffleBtn) {
      shuffleBtn.addEventListener('click', () => this.shuffleVocabulary());
    }
  }

  displayVocabulary(vocab) {
    const container = document.getElementById('vocabularyList');
    if (!container) return;
    
    container.innerHTML = vocab.map(item => this.createVocabularyCard(item)).join('');
    
    // Add event listeners
    container.querySelectorAll('.favorite-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        this.toggleFavorite(btn.dataset.id);
      });
    });
    
    container.querySelectorAll('.audio-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        this.playAudio(btn.dataset.id);
      });
    });
    
    container.querySelectorAll('.mark-learned').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        this.markAsLearned(btn.dataset.id);
      });
    });
  }

  createVocabularyCard(item) {
    const language = LANGUAGES[this.state.currentLanguage];
    const category = CATEGORIES[item.category];
    const isFavorite = this.state.favorites.has(item.id);
    
    const difficultyColors = { beginner: '#2ed573', intermediate: '#ffa502', advanced: '#ff4757' };
    const difficultyTexts = { beginner: 'рж╕рж╣ржЬ', intermediate: 'ржоржзрзНржпржо', advanced: 'ржХржарж┐ржи' };
    
    return `
      <div class="vocabulary-card" data-id="${item.id}">
        <div class="vocabulary-header">
          <div class="vocabulary-category">
            <span class="category-icon">${category?.icon || 'ЁЯУЭ'}</span>
            <span class="category-name">${category?.name || item.category}</span>
          </div>
          <div class="vocabulary-actions">
            <button class="vocab-btn favorite-btn ${isFavorite ? 'active' : ''}" 
                    data-id="${item.id}" title="ржкржЫржирзНржжрзЗрж░ рждрж╛рж▓рж┐ржХрж╛ржпрж╝ ржпрзЛржЧ ржХрж░рзБржи">
              ${isFavorite ? 'тЭдя╕П' : 'ЁЯдН'}
            </button>
            <button class="vocab-btn audio-btn" data-id="${item.id}" title="ржЙржЪрзНржЪрж╛рж░ржг рж╢рзБржирзБржи">
              ЁЯФК
            </button>
          </div>
        </div>
        
        <div class="vocabulary-content">
          <div class="original-phrase">
            <div class="phrase-text">${item[language.code]}</div>
            <div class="pronunciation">${item.pronunciation}</div>
          </div>
          
          <div class="translations">
            <div class="bengali-translation">
              <strong>ржмрж╛ржВрж▓рж╛:</strong> ${item.bn}
            </div>
            <div class="english-translation">
              <strong>English:</strong> ${item.en}
            </div>
          </div>
          
          <div class="vocabulary-footer">
            <div class="difficulty-badge" style="background: ${difficultyColors[item.difficulty]}20; color: ${difficultyColors[item.difficulty]}">
              ${difficultyTexts[item.difficulty]}
            </div>
          </div>
        </div>
        
        <div class="vocabulary-progress">
          <button class="btn btn-outline btn-small mark-learned" data-id="${item.id}">
            <span class="btn-icon">тЬУ</span>
            <span>рж╢рж┐ржЦрзЗржЫрж┐</span>
          </button>
        </div>
      </div>
    `;
  }

  filterVocabulary() {
    if (!this.state.currentLanguage) return;
    
    const categoryFilter = document.getElementById('categoryFilter');
    const selectedCategory = categoryFilter?.value || 'all';
    
    const vocab = this.state.vocabularyData.get(this.state.currentLanguage);
    if (!vocab) return;
    
    let filtered = vocab;
    if (selectedCategory !== 'all') {
      filtered = vocab.filter(item => item.category === selectedCategory);
    }
    
    this.displayVocabulary(filtered.slice(0, 20));
  }

  shuffleVocabulary() {
    if (!this.state.currentLanguage) return;
    
    const vocab = this.state.vocabularyData.get(this.state.currentLanguage);
    if (!vocab) return;
    
    const shuffled = [...vocab].sort(() => Math.random() - 0.5);
    this.displayVocabulary(shuffled.slice(0, 20));
    
    this.showToast('рж╢ржмрзНржжржЧрзБрж▓рж┐ ржПрж▓рзЛржорзЗрж▓рзЛ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ', 'info');
  }

  updateLearningStats(languageKey) {
    const progress = this.state.getTodayProgress(languageKey);
    const totalLearned = this.state.getTotalLearned(languageKey);
    
    this.updateElement('#todayLearned', progress.learned);
    this.updateElement('#totalLearned', totalLearned);
    this.updateElement('#todayProgress', progress.learned);
  }

  showLearningInterface() {
    const selection = document.getElementById('languageSelection');
    const interface = document.getElementById('learningInterface');
    
    if (selection) selection.classList.add('hidden');
    if (interface) interface.classList.remove('hidden');
  }

  // ЁЯО╡ Audio System
  async playAudio(itemId) {
    try {
      const vocab = this.state.vocabularyData.get(this.state.currentLanguage);
      const item = vocab?.find(v => v.id === itemId);
      if (!item) return;
      
      const language = LANGUAGES[this.state.currentLanguage];
      const text = item[language.code];
      const langCode = CONFIG.SPEECH_LANG_MAP[language.code] || 'en-US';
      
      // Stop current audio
      if (this.currentAudio) {
        this.speechSynth.cancel();
      }
      
      // Create speech
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = langCode;
      utterance.rate = this.state.settings.speechRate || 1;
      
      // Visual feedback
      const audioBtn = document.querySelector(`[data-id="${itemId}"].audio-btn`);
      if (audioBtn) {
        audioBtn.innerHTML = 'тП╕я╕П';
        audioBtn.classList.add('playing');
      }
      
      utterance.onend = () => {
        if (audioBtn) {
          audioBtn.innerHTML = 'ЁЯФК';
          audioBtn.classList.remove('playing');
        }
      };
      
      utterance.onerror = () => {
        if (audioBtn) {
          audioBtn.innerHTML = 'ЁЯФК';
          audioBtn.classList.remove('playing');
        }
        this.showToast('ржЕржбрж┐ржУ ржкрзНрж▓рзЗ ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛', 'error');
      };
      
      this.speechSynth.speak(utterance);
      this.currentAudio = utterance;
      
    } catch (error) {
      console.error('Audio play failed:', error);
      this.showToast('ржЕржбрж┐ржУ ржкрзНрж▓рзЗ ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛', 'error');
    }
  }

  // ЁЯТЦ Favorites System
  toggleFavorite(itemId) {
    if (this.state.favorites.has(itemId)) {
      this.state.favorites.delete(itemId);
    } else {
      this.state.favorites.add(itemId);
    }
    
    this.state.save();
    this.updateFavoriteButton(itemId);
  }

  updateFavoriteButton(itemId) {
    const btn = document.querySelector(`[data-id="${itemId}"].favorite-btn`);
    if (!btn) return;
    
    const isFavorite = this.state.favorites.has(itemId);
    btn.classList.toggle('active', isFavorite);
    btn.innerHTML = isFavorite ? 'тЭдя╕П' : 'ЁЯдН';
  }

  // ЁЯУИ Progress Tracking
  markAsLearned(itemId) {
    this.state.updateProgress(this.state.currentLanguage, 1);
    
    const btn = document.querySelector(`[data-id="${itemId}"].mark-learned`);
    if (btn) {
      btn.classList.add('learned');
      btn.innerHTML = '<span class="btn-icon">тЬЕ</span><span>рж╢рж┐ржЦрзЗржЫрж┐!</span>';
      btn.disabled = true;
    }
    
    const card = document.querySelector(`[data-id="${itemId}"]`);
    if (card) card.classList.add('learned');
    
    this.updateLearningStats(this.state.currentLanguage);
    
    const progress = this.state.getTodayProgress(this.state.currentLanguage);
    if (progress.learned >= progress.target) {
      this.showToast('ЁЯОЙ ржЖржЬржХрзЗрж░ рж▓ржХрзНрж╖рзНржп ржкрзВрж░ржг рж╣ржпрж╝рзЗржЫрзЗ!', 'success');
    }
  }

  // ЁЯФН Search System
  initializeSearch() {
    const searchToggle = document.getElementById('searchToggle');
    const globalSearch = document.getElementById('globalSearch');
    const searchInput = document.getElementById('globalSearchInput');
    const searchClose = document.getElementById('searchClose');
    
    if (searchToggle) {
      searchToggle.addEventListener('click', () => {
        globalSearch?.classList.toggle('hidden');
        if (!globalSearch?.classList.contains('hidden')) {
          searchInput?.focus();
        }
      });
    }
    
    if (searchClose) {
      searchClose.addEventListener('click', () => {
        globalSearch?.classList.add('hidden');
        if (searchInput) searchInput.value = '';
      });
    }
    
    if (searchInput) {
      searchInput.addEventListener('input', (e) => {
        clearTimeout(this.searchTimeout);
        this.searchTimeout = setTimeout(() => {
          this.performGlobalSearch(e.target.value);
        }, 300);
      });
    }
  }

  performGlobalSearch(query) {
    // Simple search implementation
    if (!query.trim()) return;
    
    this.showToast(`рж╕рж╛рж░рзНржЪ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ: "${query}"`, 'info');
    
    // In a full implementation, this would search across all vocabulary
    console.log(`ЁЯФН Searching for: ${query}`);
  }

  focusSearch() {
    const searchInput = document.getElementById('globalSearchInput');
    const globalSearch = document.getElementById('globalSearch');
    
    if (globalSearch) globalSearch.classList.remove('hidden');
    if (searchInput) searchInput.focus();
  }

  // ЁЯУ▒ Mobile Menu
  initializeMobileMenu() {
    const toggle = document.getElementById('mobileMenuToggle');
    const menu = document.getElementById('mobileMenu');
    const overlay = document.getElementById('mobileMenuOverlay');
    
    if (toggle) {
      toggle.addEventListener('click', () => this.toggleMobileMenu());
    }
    
    if (overlay) {
      overlay.addEventListener('click', () => this.closeMobileMenu());
    }
  }

  toggleMobileMenu() {
    const menu = document.getElementById('mobileMenu');
    const overlay = document.getElementById('mobileMenuOverlay');
    
    if (menu && overlay) {
      const isOpen = menu.classList.contains('open');
      
      if (isOpen) {
        this.closeMobileMenu();
      } else {
        this.openMobileMenu();
      }
    }
  }

  openMobileMenu() {
    const menu = document.getElementById('mobileMenu');
    const overlay = document.getElementById('mobileMenuOverlay');
    
    if (menu) menu.classList.add('open');
    if (overlay) overlay.classList.add('visible');
    document.body.classList.add('menu-open');
  }

  closeMobileMenu() {
    const menu = document.getElementById('mobileMenu');
    const overlay = document.getElementById('mobileMenuOverlay');
    
    if (menu) menu.classList.remove('open');
    if (overlay) overlay.classList.remove('visible');
    document.body.classList.remove('menu-open');
  }

  updateMobileMenu() {
    // Update mobile menu based on screen size
    if (window.innerWidth > 768) {
      this.closeMobileMenu();
    }
  }

  // ЁЯОи Theme System
  initializeThemeToggle() {
    const toggle = document.getElementById('themeToggle');
    if (!toggle) return;
    
    toggle.addEventListener('click', () => this.toggleTheme());
    
    // Apply saved theme
    this.applyTheme(this.state.settings.theme);
  }

  toggleTheme() {
    const newTheme = this.state.settings.theme === 'light' ? 'dark' : 'light';
    this.state.settings.theme = newTheme;
    this.state.save();
    this.applyTheme(newTheme);
  }

  applyTheme(theme) {
    document.body.classList.toggle('dark-theme', theme === 'dark');
    
    const toggle = document.getElementById('themeToggle');
    if (toggle) {
      toggle.innerHTML = theme === 'dark' ? 'тШАя╕П' : 'ЁЯМЩ';
    }
  }

  applySettings() {
    this.applyTheme(this.state.settings.theme);
    
    // Apply other settings
    if (this.state.settings.fontSize) {
      document.body.classList.add(`font-${this.state.settings.fontSize}`);
    }
  }

  // ЁЯУК Progress Content
  loadProgressContent() {
    console.log('ЁЯУК Loading progress...');
    this.updateProgressStats();
    this.updateProgressCharts();
  }

  updateProgressStats() {
    if (!this.state.currentLanguage) return;
    
    const progress = this.state.getTodayProgress(this.state.currentLanguage);
    const totalLearned = this.state.getTotalLearned(this.state.currentLanguage);
    
    this.updateElement('#progressTodayLearned', progress.learned);
    this.updateElement('#progressTotalLearned', totalLearned);
    this.updateElement('#progressDailyTarget', progress.target);
    
    const percentage = Math.round((progress.learned / progress.target) * 100);
    this.updateElement('#progressPercentage', `${percentage}%`);
    
    const progressBar = document.querySelector('.progress-bar .progress-fill');
    if (progressBar) {
      progressBar.style.width = `${Math.min(percentage, 100)}%`;
    }
  }

  updateProgressCharts() {
    // Simple progress visualization
    const container = document.getElementById('progressCharts');
    if (!container) return;
    
    container.innerHTML = `
      <div class="progress-chart">
        <h3>ржЖржЬржХрзЗрж░ ржЕржЧрзНрж░ржЧрждрж┐</h3>
        <p>ржЖржкржирж┐ ржЖржЬ ${this.state.getTodayProgress(this.state.currentLanguage || 'germany').learned} ржЯрж┐ рж╢ржмрзНржж рж╢рж┐ржЦрзЗржЫрзЗржи</p>
      </div>
    `;
  }

  // тЭдя╕П Favorites Content
  loadFavoritesContent() {
    console.log('тЭдя╕П Loading favorites...');
    this.displayFavorites();
  }

  displayFavorites() {
    const container = document.getElementById('favoritesList');
    if (!container) return;
    
    if (this.state.favorites.size === 0) {
      container.innerHTML = `
        <div class="no-favorites">
          <div class="no-favorites-icon">ЁЯТФ</div>
          <h3>ржХрзЛржи ржкржЫржирзНржжрзЗрж░ рж╢ржмрзНржж ржирзЗржЗ</h3>
          <p>рж╢ржмрзНржж рж╢рж┐ржЦрж╛рж░ рж╕ржоржпрж╝ тЭдя╕П ржмрж╛ржЯржирзЗ ржХрзНрж▓рж┐ржХ ржХрж░рзЗ ржкржЫржирзНржжрзЗрж░ рждрж╛рж▓рж┐ржХрж╛ржпрж╝ ржпрзЛржЧ ржХрж░рзБржи</p>
        </div>
      `;
      return;
    }
    
    // Display favorite items
    const favoriteItems = [];
    for (const [languageKey, vocab] of this.state.vocabularyData) {
      vocab.forEach(item => {
        if (this.state.favorites.has(item.id)) {
          favoriteItems.push({ ...item, languageKey });
        }
      });
    }
    
    container.innerHTML = favoriteItems.map(item => {
      const language = LANGUAGES[item.languageKey];
      return this.createVocabularyCard(item);
    }).join('');
  }

  // тЪЩя╕П Settings Content
  loadSettingsContent() {
    console.log('тЪЩя╕П Loading settings...');
    this.setupSettingsControls();
  }

  setupSettingsControls() {
    // Theme setting
    const themeSelect = document.getElementById('settingsTheme');
    if (themeSelect) {
      themeSelect.value = this.state.settings.theme;
      themeSelect.addEventListener('change', (e) => {
        this.state.settings.theme = e.target.value;
        this.state.save();
        this.applyTheme(e.target.value);
      });
    }
    
    // Speech rate setting
    const speechRate = document.getElementById('settingsSpeechRate');
    if (speechRate) {
      speechRate.value = this.state.settings.speechRate;
      speechRate.addEventListener('change', (e) => {
        this.state.settings.speechRate = parseFloat(e.target.value);
        this.state.save();
      });
    }
    
    // Font size setting
    const fontSize = document.getElementById('settingsFontSize');
    if (fontSize) {
      fontSize.value = this.state.settings.fontSize;
      fontSize.addEventListener('change', (e) => {
        this.state.settings.fontSize = e.target.value;
        this.state.save();
        this.applySettings();
      });
    }
  }

  // ЁЯЪи Quick Phrases
  showQuickPhrases(category) {
    console.log(`ЁЯЪи Showing quick phrases for: ${category}`);
    
    // Create modal with quick phrases
    const modal = this.createQuickPhrasesModal(category);
    document.body.appendChild(modal);
    
    // Show modal
    setTimeout(() => modal.classList.add('show'), 10);
    
    // Close on overlay click
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        this.closeQuickPhrasesModal(modal);
      }
    });
  }

  createQuickPhrasesModal(category) {
    const cat = CATEGORIES[category];
    const modal = document.createElement('div');
    modal.className = 'modal-overlay';
    
    const quickPhrases = this.getQuickPhrasesForCategory(category);
    
    modal.innerHTML = `
      <div class="modal-content">
        <div class="modal-header">
          <h2>${cat.icon} ${cat.name}</h2>
          <button class="modal-close" onclick="app.closeQuickPhrasesModal(this.closest('.modal-overlay'))">&times;</button>
        </div>
        <div class="modal-body">
          <div class="quick-phrases-list">
            ${quickPhrases.map(phrase => `
              <div class="quick-phrase-item">
                <div class="phrase-original">${phrase.text}</div>
                <div class="phrase-bengali">${phrase.bengali}</div>
                <button class="btn btn-small btn-outline" onclick="app.playQuickPhrase('${phrase.text}')">
                  ЁЯФК рж╢рзБржирзБржи
                </button>
              </div>
            `).join('')}
          </div>
        </div>
      </div>
    `;
    
    return modal;
  }

  getQuickPhrasesForCategory(category) {
    const phrases = {
      emergency: [
        { text: 'Help!', bengali: 'рж╕рж╛рж╣рж╛ржпрзНржп!' },
        { text: 'Call the police!', bengali: 'ржкрзБрж▓рж┐рж╢ ржбрж╛ржХрзБржи!' },
        { text: 'I need a doctor', bengali: 'ржЖржорж╛рж░ ржбрж╛ржХрзНрждрж╛рж░ ржжрж░ржХрж╛рж░' },
        { text: 'Where is the hospital?', bengali: 'рж╣рж╛рж╕ржкрж╛рждрж╛рж▓ ржХрзЛржерж╛ржпрж╝?' },
        { text: 'I don\'t understand', bengali: 'ржЖржорж┐ ржмрзБржЭрждрзЗ ржкрж╛рж░ржЫрж┐ ржирж╛' }
      ],
      daily: [
        { text: 'Hello', bengali: 'рж╣рзНржпрж╛рж▓рзЛ' },
        { text: 'Thank you', bengali: 'ржзржирзНржпржмрж╛ржж' },
        { text: 'Excuse me', bengali: 'ржжрзБржГржЦрж┐ржд' },
        { text: 'How much?', bengali: 'ржХржд ржжрж╛ржо?' },
        { text: 'Where is the toilet?', bengali: 'ржЯржпрж╝рж▓рзЗржЯ ржХрзЛржерж╛ржпрж╝?' }
      ],
      work: [
        { text: 'I work here', bengali: 'ржЖржорж┐ ржПржЦрж╛ржирзЗ ржХрж╛ржЬ ржХрж░рж┐' },
        { text: 'Can you help me?', bengali: 'ржЖржкржирж┐ ржХрж┐ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рждрзЗ ржкрж╛рж░рзЗржи?' },
        { text: 'Where is the office?', bengali: 'ржЕржлрж┐рж╕ ржХрзЛржерж╛ржпрж╝?' },
        { text: 'I have an appointment', bengali: 'ржЖржорж╛рж░ ржЕрзНржпрж╛ржкржпрж╝рзЗржирзНржЯржорзЗржирзНржЯ ржЖржЫрзЗ' },
        { text: 'I am new here', bengali: 'ржЖржорж┐ ржПржЦрж╛ржирзЗ ржирждрзБржи' }
      ],
      travel: [
        { text: 'Where is the station?', bengali: 'рж╕рзНржЯрзЗрж╢ржи ржХрзЛржерж╛ржпрж╝?' },
        { text: 'How much is the ticket?', bengali: 'ржЯрж┐ржХрзЗржЯрзЗрж░ ржжрж╛ржо ржХржд?' },
        { text: 'What time does it leave?', bengali: 'ржХржЦржи ржЫрж╛ржбрж╝ржмрзЗ?' },
        { text: 'Is this the right way?', bengali: 'ржПржЯрж╛ ржХрж┐ рж╕ржарж┐ржХ ржкрже?' },
        { text: 'I am lost', bengali: 'ржЖржорж┐ рж╣рж╛рж░рж┐ржпрж╝рзЗ ржЧрзЗржЫрж┐' }
      ]
    };
    
    return phrases[category] || phrases.daily;
  }

  playQuickPhrase(text) {
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'en-US';
    utterance.rate = 0.8;
    this.speechSynth.speak(utterance);
  }

  closeQuickPhrasesModal(modal) {
    modal.classList.remove('show');
    setTimeout(() => {
      if (modal.parentNode) {
        modal.parentNode.removeChild(modal);
      }
    }, 300);
  }

  // ЁЯЫая╕П Utility Functions
  updateElement(selector, content) {
    const element = document.querySelector(selector);
    if (element) {
      element.textContent = content;
    }
  }

  updateScrollEffects() {
    // Add scroll-based animations
    const scrolled = window.pageYOffset;
    const rate = scrolled * -0.5;
    
    const hero = document.querySelector('.hero-section');
    if (hero) {
      hero.style.transform = `translateY(${rate}px)`;
    }
  }

  showLanguageDetails(languageKey) {
    const language = LANGUAGES[languageKey];
    this.showToast(`${language.name} ржнрж╛рж╖рж╛рж░ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд рждржерзНржп ржжрзЗржЦрж╛ржирзЛ рж╣ржмрзЗ`, 'info');
    console.log(`тД╣я╕П Showing details for: ${language.name}`);
  }

  // ЁЯОп Toast Notification System
  showToast(message, type = 'info', duration = 3000) {
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    
    const icons = {
      success: 'тЬЕ',
      error: 'тЭМ',
      warning: 'тЪая╕П',
      info: 'тД╣я╕П'
    };
    
    toast.innerHTML = `
      <div class="toast-content">
        <span class="toast-icon">${icons[type] || 'тД╣я╕П'}</span>
        <span class="toast-message">${message}</span>
      </div>
    `;
    
    // Add to page
    const container = document.getElementById('toastContainer') || this.createToastContainer();
    container.appendChild(toast);
    
    // Show animation
    setTimeout(() => toast.classList.add('show'), 10);
    
    // Auto remove
    setTimeout(() => {
      toast.classList.remove('show');
      setTimeout(() => {
        if (toast.parentNode) {
          toast.parentNode.removeChild(toast);
        }
      }, 300);
    }, duration);
  }

  createToastContainer() {
    const container = document.createElement('div');
    container.id = 'toastContainer';
    container.className = 'toast-container';
    document.body.appendChild(container);
    return container;
  }

  showError(message) {
    this.showToast(message, 'error', 5000);
  }

  // ЁЯМЯ Additional Features
  delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  // ЁЯУ▒ PWA Features (Basic)
  initializePWA() {
    // Register service worker if available
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js')
        .then(registration => {
          console.log('тЬЕ SW registered:', registration);
        })
        .catch(error => {
          console.log('тЭМ SW registration failed:', error);
        });
    }
    
    // Install prompt
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      this.showInstallPrompt(e);
    });
  }

  showInstallPrompt(e) {
    setTimeout(() => {
      this.showToast('ржПржЗ ржЕрзНржпрж╛ржкржЯрж┐ ржЖржкржирж╛рж░ ржлрзЛржирзЗ ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи! ЁЯУ▒', 'info', 5000);
      
      // Create install button
      const installBtn = document.createElement('button');
      installBtn.textContent = 'ржЗржирж╕рзНржЯрж▓ ржХрж░рзБржи';
      installBtn.className = 'btn btn-primary install-btn';
      installBtn.onclick = () => {
        e.prompt();
        e.userChoice.then(result => {
          if (result.outcome === 'accepted') {
            this.showToast('ржЕрзНржпрж╛ржк ржЗржирж╕рзНржЯрж▓ рж╣ржЪрзНржЫрзЗ...', 'success');
          }
        });
      };
      
      document.body.appendChild(installBtn);
      
      setTimeout(() => {
        if (installBtn.parentNode) {
          installBtn.parentNode.removeChild(installBtn);
        }
      }, 10000);
    }, 5000);
  }
}

// ЁЯЪА Initialize Application
console.log('ЁЯМЯ Creating Speak EU app...');

const app = new SpeakEU();

// Start when DOM is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => {
    console.log('ЁЯУД DOM loaded, starting app...');
    app.init();
  });
} else {
  console.log('ЁЯУД DOM already ready, starting app...');
  app.init();
}

// Global error handler
window.addEventListener('error', (e) => {
  console.error('ЁЯТе Global error:', e.error);
  
  // Show user-friendly error
  if (app && app.showError) {
    app.showError('ржХрж┐ржЫрзБ ржПржХржЯрж╛ рж╕ржорж╕рзНржпрж╛ рж╣ржпрж╝рзЗржЫрзЗред ржкрзЗржЬ рж░рж┐ржлрзНрж░рзЗрж╢ ржХрж░рзЗ ржЖржмрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред');
  } else {
    // Fallback error display
    const errorDiv = document.createElement('div');
    errorDiv.innerHTML = `
      <div style="position: fixed; top: 20px; right: 20px; background: #ff4757; color: white; padding: 15px; border-radius: 8px; z-index: 10000;">
        тЭМ ржХрж┐ржЫрзБ ржПржХржЯрж╛ рж╕ржорж╕рзНржпрж╛ рж╣ржпрж╝рзЗржЫрзЗред ржкрзЗржЬ рж░рж┐ржлрзНрж░рзЗрж╢ ржХрж░рзБржиред
      </div>
    `;
    document.body.appendChild(errorDiv);
    
    setTimeout(() => {
      if (errorDiv.parentNode) {
        errorDiv.parentNode.removeChild(errorDiv);
      }
    }, 5000);
  }
});

console.log('тЬЕ Speak EU app.js loaded successfully!');

// Export for global access
window.app = app;
